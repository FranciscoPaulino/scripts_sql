select * from CADASTRO_ITEM_FISCAL
where CODIGO_ITEM = '42875'


update CADASTRO_ITEM_FISCAL
set CODIGO_ITEM = '40770F'
where CODIGO_ITEM = '40770'



exec sp_executesql N'
/* lx005102spk  CursorAdapter: CUR_V_ENTRADAS_00_SAIDA_DEVOLUCAO(Alias: v_entradas_00_saida_devolucao)  */
SELECT FATURAMENTO_ENTRADA_DEVOLUCAO.FILIAL, FATURAMENTO_ENTRADA_DEVOLUCAO.NF_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF, FATURAMENTO_ENTRADA_DEVOLUCAO.ITEM_IMPRESSAO_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.SUB_ITEM_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.NOME_CLIFOR, FATURAMENTO_ENTRADA_DEVOLUCAO.NF_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.ITEM_IMPRESSAO_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.SUB_ITEM_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.ORIGEM_ENTRADA_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.QTDE_DEVOLVIDA, QTDE_DISPONIVEL=(FATURAMENTO_ITEM.QTDE_ITEM-FATURAMENTO_ITEM.QTDE_DEVOLVIDA), FATURAMENTO.EMISSAO, FATURAMENTO_ITEM.CODIGO_ITEM, FATURAMENTO_ITEM.DESCRICAO_ITEM, FATURAMENTO_ITEM.MPADRAO_PRECO_UNITARIO AS PRECO_UNITARIO, FATURAMENTO_ITEM.DESCONTO_ITEM, FATURAMENTO_ITEM.UNIDADE, VALOR = (FATURAMENTO_ENTRADA_DEVOLUCAO.QTDE_DEVOLVIDA*FATURAMENTO_ITEM.MPADRAO_PRECO_UNITARIO), FATURAMENTO_ITEM.CLASSIF_FISCAL, FATURAMENTO_ITEM.TRIBUT_ORIGEM, FATURAMENTO_ITEM.TRIBUT_ORIGEM, FATURAMENTO_ITEM.CONTA_CONTABIL, FATURAMENTO_ITEM.INDICADOR_CFOP, FATURAMENTO_ITEM.TRIBUT_ICMS, FATURAMENTO_ITEM.UNIDADE, CONVERT(DECIMAL, 1) AS FATOR_CONVERSAO_UNIDADE, DBO.FX_PRODUCAO_PRECO(CAST((DBO.FX_PRODUCAO_PRECO(FATURAMENTO_ITEM.TIMESTAMP, ''F'') * POWER((CASE WHEN ISNULL(FATURAMENTO.CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE FATURAMENTO.CAMBIO_NA_DATA END ),(CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.F.'' THEN -1 ELSE 1 END )) )AS NUMERIC(14,2)), ''T'') AS TIMESTAMP, FATURAMENTO_ITEM.COMISSAO_ITEM, FATURAMENTO_ITEM.COMISSAO_ITEM_GERENTE, REPRESENTANTES.COD_REPRESENTANTE, REPRESENTANTES2.COD_REPRESENTANTE AS COD_REPRESENTANTE_GERENTE, FATURAMENTO_ITEM.REFERENCIA, FATURAMENTO_ITEM.REFERENCIA_ITEM, FATURAMENTO_ITEM.REFERENCIA_PEDIDO, TRIBUT_ICMS.DESCRICAO AS TRIBUT_ICMS_DESCRICAO, TRIBUT_ORIGEM.DESCRICAO AS TRIBUT_ORIGEM_DESCRICAO, CTB_CONTA_PLANO.DESC_CONTA, CLASSIF_FISCAL.DESC_CLASSIFICACAO, CTB_LX_INDICADOR_CFOP.DESCRICAO_INDICADOR_CFOP, FATURAMENTO.PORC_ENCARGO, FATURAMENTO.PORC_DESCONTO, CONVERT(BIT, 1) AS PORC_DESCONTO_DIGITADO, FATURAMENTO.CODIGO_LOCAL_ENTREGA, FATURAMENTO.NOME_CLIFOR_ENTREGA, FATURAMENTO.REPRESENTANTE, FATURAMENTO.GERENTE, FATURAMENTO_ITEM.FAIXA, FATURAMENTO_ITEM.COD_TABELA_FILHA, FATURAMENTO.AGRUPAMENTO_ITENS, CODIGO_FISCAL_OPERACAO = CTB_LX_NATUREZAS_OPERACAO.CFOP_RETORNO_DEVOLUCAO, FATURAMENTO_ITEM.ORIGEM_ITEM FROM FATURAMENTO_ENTRADA_DEVOLUCAO INNER JOIN FATURAMENTO_ITEM ON FATURAMENTO_ENTRADA_DEVOLUCAO.FILIAL = FATURAMENTO_ITEM.FILIAL AND FATURAMENTO_ENTRADA_DEVOLUCAO.NF_SAIDA = FATURAMENTO_ITEM.NF_SAIDA AND FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF = FATURAMENTO_ITEM.SERIE_NF AND FATURAMENTO_ENTRADA_DEVOLUCAO.ITEM_IMPRESSAO_SAIDA = FATURAMENTO_ITEM.ITEM_IMPRESSAO AND FATURAMENTO_ENTRADA_DEVOLUCAO.SUB_ITEM_SAIDA = FATURAMENTO_ITEM.SUB_ITEM_TAMANHO INNER JOIN FATURAMENTO ON FATURAMENTO_ITEM.FILIAL = FATURAMENTO.FILIAL AND FATURAMENTO_ITEM.NF_SAIDA = FATURAMENTO.NF_SAIDA AND FATURAMENTO_ITEM.SERIE_NF = FATURAMENTO.SERIE_NF INNER JOIN TRIBUT_ICMS ON FATURAMENTO_ITEM.TRIBUT_ICMS = TRIBUT_ICMS.TRIBUT_ICMS INNER JOIN CTB_LX_INDICADOR_CFOP ON FATURAMENTO_ITEM.INDICADOR_CFOP = CTB_LX_INDICADOR_CFOP.INDICADOR_CFOP INNER JOIN CLASSIF_FISCAL ON FATURAMENTO_ITEM.CLASSIF_FISCAL = CLASSIF_FISCAL.CLASSIF_FISCAL INNER JOIN TRIBUT_ORIGEM ON TRIBUT_ORIGEM.TRIBUT_ORIGEM = FATURAMENTO_ITEM.TRIBUT_ORIGEM INNER JOIN CTB_LX_NATUREZAS_OPERACAO ON CTB_LX_NATUREZAS_OPERACAO.CODIGO_FISCAL_OPERACAO = FATURAMENTO_ITEM.CODIGO_FISCAL_OPERACAO LEFT JOIN CTB_CONTA_PLANO ON FATURAMENTO_ITEM.CONTA_CONTABIL = CTB_CONTA_PLANO.CONTA_CONTABIL LEFT JOIN REPRESENTANTES ON FATURAMENTO.REPRESENTANTE = REPRESENTANTES.REPRESENTANTE LEFT JOIN REPRESENTANTES REPRESENTANTES2 ON FATURAMENTO.GERENTE = REPRESENTANTES2.REPRESENTANTE WHERE FATURAMENTO_ENTRADA_DEVOLUCAO.NF_ENTRADA = @P1 AND FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF_ENTRADA = @P2 AND FATURAMENTO_ENTRADA_DEVOLUCAO.NOME_CLIFOR = @P3 ORDER BY FATURAMENTO_ENTRADA_DEVOLUCAO.FILIAL, FATURAMENTO_ENTRADA_DEVOLUCAO.NF_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF',N'@P1 varchar(9),@P2 varchar(1),@P3 varchar(9)','000004189','2','Dafiti SP'


exec sp_executesql N'
/* lx005102spk  CursorAdapter: cur_v_entradas_00_prod1_ent(Alias: v_entradas_00_prod1_ent)  */
SELECT ESTOQUE_PROD1_ENT.ROMANEIO_PRODUTO, ESTOQUE_PROD1_ENT.FILIAL, ESTOQUE_PROD1_ENT.ITEM_IMPRESSAO, ESTOQUE_PROD1_ENT.PRODUTO, ESTOQUE_PROD1_ENT.COR_PRODUTO, ESTOQUE_PROD1_ENT.TAREFA, ESTOQUE_PROD1_ENT.ORDEM_PRODUCAO, ESTOQUE_PROD1_ENT.ID_MODIFICACAO, ESTOQUE_PROD1_ENT.QTDE, ESTOQUE_PROD1_ENT.EN_1, ESTOQUE_PROD1_ENT.EN_2, ESTOQUE_PROD1_ENT.EN_3, ESTOQUE_PROD1_ENT.EN_4, ESTOQUE_PROD1_ENT.EN_5, ESTOQUE_PROD1_ENT.EN_6, ESTOQUE_PROD1_ENT.EN_7, ESTOQUE_PROD1_ENT.EN_8, ESTOQUE_PROD1_ENT.EN_9, ESTOQUE_PROD1_ENT.EN_10, ESTOQUE_PROD1_ENT.EN_11, ESTOQUE_PROD1_ENT.EN_12, ESTOQUE_PROD1_ENT.EN_13, ESTOQUE_PROD1_ENT.EN_14, ESTOQUE_PROD1_ENT.EN_15, ESTOQUE_PROD1_ENT.EN_16, 0 AS EN_17, 0 AS EN_18, 0 AS EN_19, 0 AS EN_20, 0 AS EN_21, 0 AS EN_22, 0 AS EN_23, 0 AS EN_24, 0 AS EN_25, 0 AS EN_26, 0 AS EN_27, 0 AS EN_28, 0 AS EN_29, 0 AS EN_30, 0 AS EN_31, 0 AS EN_32, 0 AS EN_33, 0 AS EN_34, 0 AS EN_35, 0 AS EN_36, 0 AS EN_37, 0 AS EN_38, 0 AS EN_39, 0 AS EN_40, 0 AS EN_41, 0 AS EN_42, 0 AS EN_43, 0 AS EN_44, 0 AS EN_45, 0 AS EN_46, 0 AS EN_47, 0 AS EN_48, ESTOQUE_PROD1_ENT.CUSTO1, ESTOQUE_PROD1_ENT.CUSTO2, ESTOQUE_PROD1_ENT.CUSTO3, ESTOQUE_PROD1_ENT.CUSTO4, ESTOQUE_PROD1_ENT.DESCONTO_ITEM, ESTOQUE_PROD1_ENT.VALOR, CAST((ESTOQUE_PROD1_ENT.CUSTO1 * POWER((CASE WHEN ISNULL(ENTRADAS.CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE ENTRADAS.CAMBIO_NA_DATA END ), ((CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.F.'' THEN -1 ELSE 1 END ) * -1 )) ) AS NUMERIC(18,6)) AS CUSTO_MOEDA1, CAST((ESTOQUE_PROD1_ENT.CUSTO2 * POWER((CASE WHEN ISNULL(ENTRADAS.CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE ENTRADAS.CAMBIO_NA_DATA END ), ((CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.F.'' THEN -1 ELSE 1 END ) * -1 )) ) AS NUMERIC(18,6)) AS CUSTO_MOEDA2, CAST((ESTOQUE_PROD1_ENT.CUSTO3 * POWER((CASE WHEN ISNULL(ENTRADAS.CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE ENTRADAS.CAMBIO_NA_DATA END ), ((CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.F.'' THEN -1 ELSE 1 END ) * -1 )) ) AS NUMERIC(18,6)) AS CUSTO_MOEDA3, CAST((ESTOQUE_PROD1_ENT.CUSTO4 * POWER((CASE WHEN ISNULL(ENTRADAS.CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE ENTRADAS.CAMBIO_NA_DATA END ), ((CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.F.'' THEN -1 ELSE 1 END ) * -1 )) ) AS NUMERIC(18,6)) AS CUSTO_MOEDA4, CONVERT(NUMERIC(18,6), (ESTOQUE_PROD1_ENT.CUSTO1 / (CASE WHEN ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) = 100 THEN 1 ELSE (1 - (ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) / 100 ) ) END ))) AS CUSTO_CHEIO1, CONVERT(NUMERIC(18,6), (ESTOQUE_PROD1_ENT.CUSTO2 / (CASE WHEN ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) = 100 THEN 1 ELSE (1 - (ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) / 100 ) ) END ))) AS CUSTO_CHEIO2, CONVERT(NUMERIC(18,6), (ESTOQUE_PROD1_ENT.CUSTO3 / (CASE WHEN ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) = 100 THEN 1 ELSE (1 - (ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) / 100 ) ) END ))) AS CUSTO_CHEIO3, CONVERT(NUMERIC(18,6), (ESTOQUE_PROD1_ENT.CUSTO4 / (CASE WHEN ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) = 100 THEN 1 ELSE (1 - (ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0) / 100 ) ) END ))) AS CUSTO_CHEIO4, ESTOQUE_PROD1_ENT.SEGUNDA_QUALIDADE, ESTOQUE_PROD1_ENT.DATA_CUSTO, ESTOQUE_PROD1_ENT.MATA_SALDO_PEDIDO, ESTOQUE_PROD1_ENT.PEDIDO_VENDA, ESTOQUE_PROD1_ENT.PEDIDO_VENDA_ENTREGA, ESTOQUE_PROD1_ENT.PEDIDO_VENDA_ITEM, ESTOQUE_PROD_ENT.PEDIDO, ESTOQUE_PROD_ENT.ENTREGA_PEDIDO, ESTOQUE_PROD_ENT.NOME_CLIFOR, ESTOQUE_PROD_ENT.NF_ENTRADA, ESTOQUE_PROD_ENT.SERIE_NF_ENTRADA, PRODUTOS.CLASSIF_FISCAL, PRODUTOS.DESC_PRODUTO, PRODUTOS.DESC_PROD_NF, PRODUTOS.UNIDADE, PRODUTOS.REFER_FABRICANTE, PRODUTOS.GRADE, PRODUTOS.VARIA_CUSTO_COR, PRODUTOS.VARIA_CUSTO_TAM, PRODUTOS.VARIA_PRECO_COR, PRODUTOS.VARIA_PRECO_TAM, PRODUTOS.PONTEIRO_PRECO_TAM, PRODUTOS.TRIBUT_ICMS, ISNULL(PRODUTOS_INDICADOR_CFOP.TRIBUT_ORIGEM, ISNULL(PRODUTO_CORES.TRIBUT_ORIGEM, PRODUTOS.TRIBUT_ORIGEM)) AS TRIBUT_ORIGEM, DBO.FX_CTB_BUSCA_CONTA_ITEM(''E'', ''P'', @P1, @P2, @P3, @P4, NULL) AS CONTA_CONTABIL, ISNULL(PRODUTOS_INDICADOR_CFOP.INDICADOR_CFOP, (CASE WHEN ISNULL(FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, 0) = 1 AND PRODUTOS.INDICADOR_CFOP = 10 THEN 11 ELSE PRODUTOS.INDICADOR_CFOP END )) AS INDICADOR_CFOP, PRODUTO_CORES.DESC_COR_PRODUTO, PRODUTO_CORES.COR_FABRICANTE, CONVERT(VARCHAR(15), NULL) AS RATEIO_CENTRO_CUSTO, CONVERT(VARCHAR(40), NULL) AS DESC_RATEIO_CENTRO_CUSTO, CONVERT(VARCHAR(15), '''') AS RATEIO_FILIAL, CONVERT(VARCHAR(40), '''') AS DESC_RATEIO_FILIAL, ESTOQUE_PROD1_ENT.COMISSAO, ESTOQUE_PROD1_ENT.COMISSAO_GERENTE, ESTOQUE_PROD1_ENT.COD_REPRESENTANTE, ESTOQUE_PROD1_ENT.COD_REPRESENTANTE_GERENTE, ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS, 0.00) AS COMPRIMENTO_DE_ROLOS, CONVERT(NUMERIC(16, 2), 0) AS VALOR_COMPLEMENTO, CONVERT(NUMERIC(8, 5), 0) AS PORCENTAGEM_ITEM_RATEIO, COMPRAS.PEDIDO_FORNECEDOR, MODIFICACAO_FICHA_TECNICA.DESC_MODIFICACAO, ISNULL(PRODUTOS.PESO, 0) AS PESO, ESTOQUE_PROD1_ENT.PACKS, PRODUTOS.POSSUI_GTIN, CONVERT(BIT, 0) AS PROD_XML FROM ESTOQUE_PROD1_ENT INNER JOIN ESTOQUE_PROD_ENT ON ESTOQUE_PROD1_ENT.FILIAL = ESTOQUE_PROD_ENT.FILIAL AND ESTOQUE_PROD1_ENT.ROMANEIO_PRODUTO = ESTOQUE_PROD_ENT.ROMANEIO_PRODUTO INNER JOIN PRODUTOS ON ESTOQUE_PROD1_ENT.PRODUTO = PRODUTOS.PRODUTO INNER JOIN PRODUTO_CORES ON ESTOQUE_PROD1_ENT.PRODUTO = PRODUTO_CORES.PRODUTO AND ESTOQUE_PROD1_ENT.COR_PRODUTO = PRODUTO_CORES.COR_PRODUTO INNER JOIN ENTRADAS ON ESTOQUE_PROD_ENT.NF_ENTRADA = ENTRADAS.NF_ENTRADA AND ESTOQUE_PROD_ENT.NOME_CLIFOR = ENTRADAS.NOME_CLIFOR AND ESTOQUE_PROD_ENT.SERIE_NF_ENTRADA = ENTRADAS.SERIE_NF_ENTRADA INNER JOIN FILIAIS ON FILIAIS.FILIAL = ENTRADAS.FILIAL LEFT JOIN PRODUTOS_INDICADOR_CFOP ON ESTOQUE_PROD1_ENT.PRODUTO = PRODUTOS_INDICADOR_CFOP.PRODUTO AND PRODUTOS_INDICADOR_CFOP.FILIAL = FILIAIS.FILIAL LEFT JOIN COMPRAS ON ESTOQUE_PROD_ENT.PEDIDO = COMPRAS.PEDIDO LEFT JOIN MODIFICACAO_FICHA_TECNICA ON ESTOQUE_PROD1_ENT.ID_MODIFICACAO = MODIFICACAO_FICHA_TECNICA.ID_MODIFICACAO WHERE ESTOQUE_PROD_ENT.NF_ENTRADA = @P5 AND ESTOQUE_PROD_ENT.NOME_CLIFOR = @P6 AND ESTOQUE_PROD_ENT.SERIE_NF_ENTRADA = @P7',N'@P1 varchar(1),@P2 int,@P3 varchar(1),@P4 varchar(6),@P5 varchar(9),@P6 varchar(9),@P7 varchar(1)','D',250,'','250.01','000004189','Dafiti SP','2'


exec sp_executesql N'
/* lx005102spk  CursorAdapter: CUR_V_ENTRADAS_00_ITENS(Alias: v_entradas_00_itens)  */
SELECT ENTRADAS_ITEM.NOME_CLIFOR, ENTRADAS_ITEM.NF_ENTRADA, ENTRADAS_ITEM.SERIE_NF_ENTRADA, ENTRADAS_ITEM.ITEM_IMPRESSAO, ENTRADAS_ITEM.SUB_ITEM_TAMANHO, ENTRADAS_ITEM.DESCRICAO_ITEM, ENTRADAS_ITEM.QTDE_ITEM, ENTRADAS_ITEM.PRECO_UNITARIO, ENTRADAS_ITEM.CODIGO_ITEM, ENTRADAS_ITEM.DESCONTO_ITEM, ENTRADAS_ITEM.VALOR_ITEM, ENTRADAS_ITEM.COD_TABELA_FILHA, ENTRADAS_ITEM.TRIBUT_ICMS, TRIBUT_ICMS.DESCRICAO AS DESC_TRIBUT_ICMS, ENTRADAS_ITEM.TRIBUT_ORIGEM, TRIBUT_ORIGEM.DESCRICAO AS DESC_TRIBUT_ORIGEM, ENTRADAS_ITEM.UNIDADE, ENTRADAS_ITEM.CLASSIF_FISCAL, CLASSIF_FISCAL.DESC_CLASSIFICACAO, ENTRADAS_ITEM.CODIGO_FISCAL_OPERACAO, CTB_LX_NATUREZAS_OPERACAO.DENOMINACAO, ENTRADAS_ITEM.PESO, ENTRADAS_ITEM.CONTA_CONTABIL, CTB_CONTA_PLANO.DESC_CONTA, ENTRADAS_ITEM.QTDE_RETORNAR_BENEFICIAMENTO, ENTRADAS_ITEM.FAIXA, ENTRADAS_ITEM.COMISSAO_ITEM, ENTRADAS_ITEM.COMISSAO_ITEM_GERENTE, ENTRADAS_ITEM.INDICADOR_CFOP, CTB_LX_INDICADOR_CFOP.DESCRICAO_INDICADOR_CFOP, ENTRADAS_ITEM.QTDE_DEVOLVIDA, ENTRADAS_ITEM.PORCENTAGEM_ITEM_RATEIO, ENTRADAS_ITEM.ID_EXCECAO_IMPOSTO, CONVERT(NUMERIC(1),0) AS GERA_IMPOSTO, ENTRADAS_ITEM.REFERENCIA, ENTRADAS_ITEM.REFERENCIA_ITEM, ENTRADAS_ITEM.REFERENCIA_PEDIDO, ENTRADAS_ITEM.DIVERGENTE, ENTRADAS_ITEM.TIMESTAMP, ENTRADAS_ITEM.VALOR_ENCARGOS, ENTRADAS_ITEM.VALOR_DESCONTOS, ENTRADAS_ITEM.NAO_SOMA_VALOR, ENTRADAS_ITEM.VALOR_ENCARGOS_IMPORTACAO, ENTRADAS_ITEM.RATEIO_FILIAL, CTB_FILIAL_RATEIO.DESC_RATEIO_FILIAL, ENTRADAS_ITEM.RATEIO_CENTRO_CUSTO, ENTRADAS_ITEM.COD_REPRESENTANTE, ENTRADAS_ITEM.COD_REPRESENTANTE_GERENTE, CTB_CENTRO_CUSTO_RATEIO.DESC_RATEIO_CENTRO_CUSTO, ISNULL(COMPRAS.COMPRIMENTO_DE_ROLOS,0.00) AS COMPRIMENTO_DE_ROLOS,CADASTRO_ITEM_FISCAL.ITEM_FISCAL_GRUPO, CADASTRO_ITEM_GRUPO.DESC_ITEM_FISCAL_GRUPO, ENTRADAS_ITEM.VALOR_ENCARGOS_ADUANEIROS, ISNULL(CTB_EXCECAO_IMPOSTO.NAO_FATURA, 0) AS NAO_FATURA, ENTRADAS_ITEM.PORC_ITEM_RATEIO_FRETE, ITEM_NFE, ENTRADAS_ITEM.MPADRAO_SEGURO_ITEM, ENTRADAS_ITEM.MPADRAO_FRETE_ITEM, ENTRADAS_ITEM.MPADRAO_ENCARGO_ITEM, ENTRADAS_ITEM.ORIGEM_ITEM   FROM ENTRADAS_ITEM INNER JOIN TRIBUT_ORIGEM ON ENTRADAS_ITEM.TRIBUT_ORIGEM = TRIBUT_ORIGEM.TRIBUT_ORIGEM INNER JOIN TRIBUT_ICMS ON ENTRADAS_ITEM.TRIBUT_ICMS = TRIBUT_ICMS.TRIBUT_ICMS INNER JOIN CLASSIF_FISCAL ON ENTRADAS_ITEM.CLASSIF_FISCAL = CLASSIF_FISCAL.CLASSIF_FISCAL INNER JOIN CTB_LX_NATUREZAS_OPERACAO ON ENTRADAS_ITEM.CODIGO_FISCAL_OPERACAO = CTB_LX_NATUREZAS_OPERACAO.CODIGO_FISCAL_OPERACAO LEFT JOIN CTB_CONTA_PLANO ON ENTRADAS_ITEM.CONTA_CONTABIL = CTB_CONTA_PLANO.CONTA_CONTABIL LEFT JOIN CTB_LX_INDICADOR_CFOP ON ENTRADAS_ITEM.INDICADOR_CFOP = CTB_LX_INDICADOR_CFOP.INDICADOR_CFOP LEFT JOIN CTB_CENTRO_CUSTO_RATEIO ON ENTRADAS_ITEM.RATEIO_CENTRO_CUSTO = CTB_CENTRO_CUSTO_RATEIO.RATEIO_CENTRO_CUSTO LEFT JOIN CTB_FILIAL_RATEIO ON ENTRADAS_ITEM.RATEIO_FILIAL = CTB_FILIAL_RATEIO.RATEIO_FILIAL LEFT JOIN COMPRAS ON ENTRADAS_ITEM.REFERENCIA_PEDIDO = COMPRAS.PEDIDO LEFT JOIN CADASTRO_ITEM_FISCAL ON CADASTRO_ITEM_FISCAL.CODIGO_ITEM = ENTRADAS_ITEM.CODIGO_ITEM LEFT JOIN CADASTRO_ITEM_GRUPO ON CADASTRO_ITEM_GRUPO.ITEM_FISCAL_GRUPO = CADASTRO_ITEM_FISCAL.ITEM_FISCAL_GRUPO LEFT JOIN CTB_EXCECAO_IMPOSTO ON ENTRADAS_ITEM.ID_EXCECAO_IMPOSTO = CTB_EXCECAO_IMPOSTO.ID_EXCECAO_IMPOSTO WHERE ENTRADAS_ITEM.NF_ENTRADA = @P1 AND ENTRADAS_ITEM.NOME_CLIFOR = @P2 AND ENTRADAS_ITEM.SERIE_NF_ENTRADA = @P3',N'@P1 varchar(9),@P2 varchar(9),@P3 varchar(1)','000004189','Dafiti SP','2'



exec sp_executesql N'
/* lx005102spk  CursorAdapter: CUR_V_ENTRADAS_00(Alias: v_entradas_00)  */
SELECT ENTRADAS.NF_ENTRADA, ENTRADAS.NOME_CLIFOR, ENTRADAS.OBS, CADASTRO_CLI_FOR.CLIFOR, CADASTRO_CLI_FOR.UF, CADASTRO_CLI_FOR.CONTA_CONTABIL, CADASTRO_CLI_FOR.CGC_CPF, CADASTRO_CLI_FOR.POSSUI_RECARGO, CADASTRO_CLI_FOR.PJ_PF, CADASTRO_CLI_FOR.INDICADOR_FISCAL_TERCEIRO, CTB_LX_INDICADOR_FISCAL_TERCEIRO.DESCRICAO_FISCAL_TERCEIRO, CADASTRO_CLI_FOR.PAIS, CADASTRO_CLI_FOR.RAZAO_SOCIAL, CADASTRO_CLI_FOR.RG_IE, CADASTRO_CLI_FOR.ACEITA_DIAS_FIXO, CADASTRO_CLI_FOR.ENDERECO, CADASTRO_CLI_FOR.BAIRRO, CADASTRO_CLI_FOR.CEP, CADASTRO_CLI_FOR.CIDADE, CADASTRO_CLI_FOR.UF, CADASTRO_CLI_FOR.DDI, CADASTRO_CLI_FOR.DDD1, CADASTRO_CLI_FOR.TELEFONE1, CADASTRO_CLI_FOR.RAMAL1, CADASTRO_CLI_FOR.DDD2, CADASTRO_CLI_FOR.TELEFONE2, CADASTRO_CLI_FOR.RAMAL2, CADASTRO_CLI_FOR.DDDFAX, CADASTRO_CLI_FOR.FAX, CADASTRO_CLI_FOR.CONTATO, CADASTRO_CLI_FOR.EMAIL, ENTRADAS.EMISSAO, ENTRADAS.FILIAL_ENTRADA, ENTRADAS.FILIAL_COBRANCA, ENTRADAS.FILIAL, FILIAIS.CLIFOR, FILIAIS.COD_FILIAL, ENTRADAS.EMPRESA, FILIAIS.ESTOQUE_CTRL_PECA, CADASTRO_CLI_FOR_A.UF AS FILIAL_UF, CADASTRO_CLI_FOR_A.PAIS AS FILIAL_PAIS, ENTRADAS.AGRUPAMENTO_ITENS, ENTRADAS.FATURA, ENTRADAS.COD_TRANSACAO, ENTRADAS.NATUREZA, NATUREZAS_ENTRADAS.DESC_NATUREZA, NATUREZAS_ENTRADAS.CTB_TIPO_OPERACAO, CTB_LX_TIPO_OPERACAO.DESC_TIPO_OPERACAO, CTB_LX_TIPO_OPERACAO.TIPO_OPERACAO, NATUREZAS_ENTRADAS.NAO_MOSTRA_VALORES, ENTRADAS.CONDICAO_PGTO, COND_ENT_PGTOS.DESC_COND_PGTO, COND_ENT_PGTOS.TIPO_CONDICAO, ENTRADAS.RECEBIMENTO, ENTRADAS.NF_FATURA, ENTRADAS.SERIE_NF_ENTRADA, ENTRADAS.ACERTO_CONTAS_P_R, ENTRADAS.NF_PROPRIA_EMITIDA, ENTRADAS.NF_ENTRADA_PROPRIA, ENTRADAS.TABELA_FILHA, ENTRADAS.TRANSF_FILIAL, ENTRADAS.LANCAMENTO, ENTRADAS.TIPO_ENTRADAS, ENTRADAS.TRANSPORTADORA_A_PAGAR, ENTRADAS.NF_ENTRADA_CONHECIMENTO, ENTRADAS.NUMERO_CONHECIMENTO_RELACIONADO, ENTRADAS.MOEDA, ENTRADAS.MOEDA_COMPRA, ENTRADAS.IMPORTACAO, ENTRADAS.DATA_DIGITACAO, ENTRADAS.ORIGEM, ENTRADAS.CONFERENCIA, ENTRADAS.EMBALAGENS, CAST((ENTRADAS.VALOR_TOTAL * POWER((CASE WHEN ISNULL(CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE CAMBIO_NA_DATA END ), ((CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.T.'' THEN 1 ELSE -1 END ) * -1 ) ) ) AS NUMERIC(14, 2)) AS TOTAL_MOEDA_ENTRADA, CAST((VALOR_TOTAL + VALOR_FRETE_TRANSPORTADORA + IMPORTACAO_IMPOSTO + IMPORTACAO_ICMS + IMPORTACAO_IPI + IMPORTACAO_ALFANDEGA + IMPORTACAO_OUTRAS_DESPESAS + IMPORTACAO_FRETE + IMPORTACAO_SEGURO + IMPORTACAO_DESEMBARACO ) AS NUMERIC(14, 2)) AS TOTAL_GERAL_ENTRADA, CAST(0 AS NUMERIC(8, 2)) AS PORC_TOTAL_GERAL, ENTRADAS.CTB_LANCAMENTO, ENTRADAS.CTB_ITEM, ENTRADAS.TIPO_VOLUME, ENTRADAS.RATEIO_FILIAL, CTB_FILIAL_RATEIO.DESC_RATEIO_FILIAL, ENTRADAS.RATEIO_CENTRO_CUSTO, CTB_CENTRO_CUSTO_RATEIO.DESC_RATEIO_CENTRO_CUSTO, ENTRADAS.COMPRIMENTO_DE_ROLOS, ENTRADAS.DATA_FATURAMENTO_RELATIVO, ENTRADAS.UTILIZA_DIAS_FIXOS_FORNECEDOR, ENTRADAS.NOME_CLIFOR_TRIANGULAR, ENTRADAS.SERIE_NF, SERIES_NF.DESCRICAO, ENTRADAS.NUMERO_CONFERENCIA, ENTRADAS.NUMERO_ENTRADA, ENTRADAS.FATURA_NOME_CLIFOR, ENTRADAS.FATURA_SERIE, ENTRADAS.FATURA_NUMERO, ENTRADAS.MARCA_EXPORTACAO, ENTRADAS.ATUALIZACAO_EXPORTAR, ENTRADAS.DATA_EXPORTACAO, ENTRADAS.STATUS_TRANSITO, FILIAIS.EMPRESA, ENTRADAS.DIFERENCA_VALOR, ENTRADAS.FRETE, ENTRADAS.SEGURO, ENTRADAS.DESCONTO, ENTRADAS.ENCARGO, ENTRADAS.QTDE_TOTAL, ENTRADAS.QTDE_TOTAL_AUX, ENTRADAS.VALOR_TOTAL, ENTRADAS.DEVOLUCAO, ENTRADAS.FRETE_A_PAGAR, ENTRADAS.IMPORTACAO_IMPOSTO, ENTRADAS.IMPORTACAO_ICMS, ENTRADAS.IMPORTACAO_IPI, ENTRADAS.IMPORTACAO_ALFANDEGA, ENTRADAS.IMPORTACAO_OUTRAS_DESPESAS, ENTRADAS.IMPORTACAO_FRETE, ENTRADAS.IMPORTACAO_SEGURO, ENTRADAS.IMPORTACAO_DESEMBARACO, ENTRADAS.PESO, ENTRADAS.PESO_BRUTO, ENTRADAS.PORC_DESCONTO, ENTRADAS.PORC_ENCARGO, ENTRADAS.COMISSAO_VALOR, ENTRADAS.COMISSAO_VALOR_GERENTE, ENTRADAS.PORC_DESCONTO_DIGITADO, ENTRADAS.VALOR_IMPOSTO_AGREGAR, ENTRADAS.VALOR_SUB_ITENS, ENTRADAS.VALOR_FRETE_TRANSPORTADORA, ENTRADAS.CAMBIO_NA_DATA, ENTRADAS.ITEM_DIGITADO, CONVERT(BIT, 0) AS SEQUENCIAL_POR_FILIAL, ENTRADAS.FILIAL_SAIDA, ENTRADAS.NF_SAIDA, ENTRADAS.SERIE_NF_SAIDA, CTB_LX_TIPO_OPERACAO.GERA_FINANCEIRO, NATUREZAS_ENTRADAS.LX_TIPO_LANCAMENTO, ISNULL(FILIAIS.MATRIZ_FISCAL, FILIAIS.FILIAL) AS FILIAL_MATRIZ_FISCAL, ISNULL(FILIAIS.MATRIZ, FILIAIS.FILIAL) AS FILIAL_MATRIZ_CONTABIL, CADASTRO_CLI_FOR.INDICA_FILIAL, ENTRADAS.ESPECIE_SERIE, CTB_ESPECIE_SERIE.DESC_ESPECIE_SERIE, ENTRADAS.VALOR_CANCELADO, ENTRADAS.QTDE_CANCELADA, ENTRADAS.DATA_CANCELAMENTO, ENTRADAS.NOTA_CANCELADA, ENTRADAS.NOTA_COMPLEMENTAR, FILIAIS_COBRANCA.COD_FILIAL AS COD_FILIAL_COBRANCA, ENTRADAS.COD_CLIFOR_SACADO, SACADO.NOME_CLIFOR AS NOME_SACADO, ENTRADAS.IMPORTACAO_TX_CAPATAZIA, ENTRADAS.SEQUENCIAL_UNICO, ENTRADAS.DATA_GERACAO_NSU, CAST((CASE WHEN ISNULL(ENTRADAS.CODIGO_CLIENTE_VAREJO, '''') = '''' THEN 0 ELSE 1 END ) AS BIT) AS UTILIZA_CLIENTE_VAREJO, ENTRADAS.CODIGO_CLIENTE_VAREJO, CLIENTES_VAREJO.CLIENTE_VAREJO, ENTRADAS.PROTOCOLO_AUTORIZACAO_NFE, ENTRADAS.STATUS_NFE, ENTRADAS.CHAVE_NFE, ENTRADAS.LOG_STATUS_NFE, ENTRADAS.MOTIVO_CANCELAMENTO_NFE, ENTRADAS.PRIORIZACAO, ENTRADAS.TIPO_EMISSAO_NFE, ENTRADAS.FIN_EMISSAO_NFE, ENTRADAS.DATA_AUTORIZACAO_NFE, ENTRADAS.REGISTRO_DPEC, ENTRADAS.DATA_REGISTRO_DPEC, ENTRADAS.PROTOCOLO_CANCELAMENTO_NFE, ENTRADAS.OBS_INTERESSE_FISCO, ENTRADAS.CFOP_CANCELAMENTO, CTB_ESPECIE_SERIE.NUMERO_MODELO_FISCAL, ENTRADAS.DATA_CONTINGENCIA, ENTRADAS.JUSTIFICATIVA_CONTINGENCIA, CLIENTES_VAREJO.PF_PJ AS CV_PF_PJ, CLIENTES_VAREJO.CPF_CGC AS CV_CPF_CGC, CLIENTES_VAREJO.RG_IE AS CV_RG_IE, CLIENTES_VAREJO.ENDERECO AS CV_ENDERECO, CLIENTES_VAREJO.NUMERO AS CV_NUMERO, CLIENTES_VAREJO.COMPLEMENTO AS CV_COMPLEMENTO, CLIENTES_VAREJO.BAIRRO AS CV_BAIRRO, CLIENTES_VAREJO.CIDADE AS CV_CIDADE, CLIENTES_VAREJO.UF AS CV_UF, CLIENTES_VAREJO.TELEFONE AS CV_TELEFONE, CLIENTES_VAREJO.CEP AS CV_CEP, CLIENTES_VAREJO.PAIS AS CV_PAIS, ENTRADAS.IND_NAT_FRT, ENTRADAS.VEICULO_PLACA, ENTRADAS.MARCA_VOLUMES, ENTRADAS.NUMERACAO_VOLUMES, ENTRADAS.UF_PLACA_VEICULO FROM ENTRADAS INNER JOIN CADASTRO_CLI_FOR ON ENTRADAS.NOME_CLIFOR = CADASTRO_CLI_FOR.NOME_CLIFOR INNER JOIN CADASTRO_CLI_FOR AS SACADO ON ENTRADAS.COD_CLIFOR_SACADO = SACADO.COD_CLIFOR INNER JOIN FILIAIS ON ENTRADAS.FILIAL = FILIAIS.FILIAL LEFT JOIN CADASTRO_CLI_FOR AS CADASTRO_CLI_FOR_A ON FILIAIS.FILIAL = CADASTRO_CLI_FOR_A.NOME_CLIFOR INNER JOIN NATUREZAS_ENTRADAS ON ENTRADAS.NATUREZA = NATUREZAS_ENTRADAS.NATUREZA INNER JOIN CTB_LX_TIPO_OPERACAO ON CTB_LX_TIPO_OPERACAO.CTB_TIPO_OPERACAO = NATUREZAS_ENTRADAS.CTB_TIPO_OPERACAO INNER JOIN COND_ENT_PGTOS ON ENTRADAS.CONDICAO_PGTO = COND_ENT_PGTOS.CONDICAO_PGTO LEFT JOIN SERIES_NF ON ENTRADAS.SERIE_NF = SERIES_NF.SERIE_NF LEFT JOIN CTB_FILIAL_RATEIO ON ENTRADAS.RATEIO_FILIAL = CTB_FILIAL_RATEIO.RATEIO_FILIAL LEFT JOIN CTB_CENTRO_CUSTO_RATEIO ON ENTRADAS.RATEIO_CENTRO_CUSTO = CTB_CENTRO_CUSTO_RATEIO.RATEIO_CENTRO_CUSTO LEFT JOIN CTB_LX_INDICADOR_FISCAL_TERCEIRO ON CADASTRO_CLI_FOR.INDICADOR_FISCAL_TERCEIRO = CTB_LX_INDICADOR_FISCAL_TERCEIRO.INDICADOR_FISCAL_TERCEIRO LEFT JOIN FILIAIS AS FILIAIS_COBRANCA ON ENTRADAS.FILIAL_COBRANCA = FILIAIS_COBRANCA.FILIAL LEFT JOIN CTB_ESPECIE_SERIE ON CTB_ESPECIE_SERIE.ESPECIE_SERIE = ENTRADAS.ESPECIE_SERIE LEFT JOIN CLIENTES_VAREJO ON ENTRADAS.CODIGO_CLIENTE_VAREJO = CLIENTES_VAREJO.CODIGO_CLIENTE WHERE cod_transacao = ''ENTRADAS_102'' and (ENTRADAS.RECEBIMENTO >= ''01/03/2013'' AND ENTRADAS.RECEBIMENTO <= ''30/06/2013'') AND ENTRADAS.NATUREZA = @P1',N'@P1 varchar(6)','250.01'



SELECT ENTRADAS.NF_ENTRADA, ENTRADAS.NOME_CLIFOR, ENTRADAS.OBS, CADASTRO_CLI_FOR.CLIFOR, 
CADASTRO_CLI_FOR.UF, CADASTRO_CLI_FOR.CONTA_CONTABIL, CADASTRO_CLI_FOR.CGC_CPF, 
CADASTRO_CLI_FOR.POSSUI_RECARGO, CADASTRO_CLI_FOR.PJ_PF, CADASTRO_CLI_FOR.INDICADOR_FISCAL_TERCEIRO, 
CTB_LX_INDICADOR_FISCAL_TERCEIRO.DESCRICAO_FISCAL_TERCEIRO, CADASTRO_CLI_FOR.PAIS, 
CADASTRO_CLI_FOR.RAZAO_SOCIAL, CADASTRO_CLI_FOR.RG_IE, CADASTRO_CLI_FOR.ACEITA_DIAS_FIXO, 
CADASTRO_CLI_FOR.ENDERECO, CADASTRO_CLI_FOR.BAIRRO, CADASTRO_CLI_FOR.CEP, CADASTRO_CLI_FOR.CIDADE, 
CADASTRO_CLI_FOR.UF, CADASTRO_CLI_FOR.DDI, CADASTRO_CLI_FOR.DDD1, CADASTRO_CLI_FOR.TELEFONE1, 
CADASTRO_CLI_FOR.RAMAL1, CADASTRO_CLI_FOR.DDD2, CADASTRO_CLI_FOR.TELEFONE2, CADASTRO_CLI_FOR.RAMAL2, 
CADASTRO_CLI_FOR.DDDFAX, CADASTRO_CLI_FOR.FAX, CADASTRO_CLI_FOR.CONTATO, CADASTRO_CLI_FOR.EMAIL, 
ENTRADAS.EMISSAO, ENTRADAS.FILIAL_ENTRADA, ENTRADAS.FILIAL_COBRANCA, ENTRADAS.FILIAL, FILIAIS.CLIFOR, 
FILIAIS.COD_FILIAL, ENTRADAS.EMPRESA, FILIAIS.ESTOQUE_CTRL_PECA, CADASTRO_CLI_FOR_A.UF AS FILIAL_UF, 
CADASTRO_CLI_FOR_A.PAIS AS FILIAL_PAIS, ENTRADAS.AGRUPAMENTO_ITENS, ENTRADAS.FATURA, ENTRADAS.COD_TRANSACAO, 
ENTRADAS.NATUREZA, NATUREZAS_ENTRADAS.DESC_NATUREZA, NATUREZAS_ENTRADAS.CTB_TIPO_OPERACAO, 
CTB_LX_TIPO_OPERACAO.DESC_TIPO_OPERACAO, CTB_LX_TIPO_OPERACAO.TIPO_OPERACAO, NATUREZAS_ENTRADAS.NAO_MOSTRA_VALORES, 
ENTRADAS.CONDICAO_PGTO, COND_ENT_PGTOS.DESC_COND_PGTO, COND_ENT_PGTOS.TIPO_CONDICAO, ENTRADAS.RECEBIMENTO, 
ENTRADAS.NF_FATURA, ENTRADAS.SERIE_NF_ENTRADA, ENTRADAS.ACERTO_CONTAS_P_R, ENTRADAS.NF_PROPRIA_EMITIDA, 
ENTRADAS.NF_ENTRADA_PROPRIA, ENTRADAS.TABELA_FILHA, ENTRADAS.TRANSF_FILIAL, ENTRADAS.LANCAMENTO,
 ENTRADAS.TIPO_ENTRADAS, ENTRADAS.TRANSPORTADORA_A_PAGAR, ENTRADAS.NF_ENTRADA_CONHECIMENTO, 
 ENTRADAS.NUMERO_CONHECIMENTO_RELACIONADO, ENTRADAS.MOEDA, ENTRADAS.MOEDA_COMPRA, ENTRADAS.IMPORTACAO, 
 ENTRADAS.DATA_DIGITACAO, ENTRADAS.ORIGEM, ENTRADAS.CONFERENCIA, ENTRADAS.EMBALAGENS, 
 CAST((ENTRADAS.VALOR_TOTAL * POWER((CASE WHEN ISNULL(CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE CAMBIO_NA_DATA END ), 
 ((CASE WHEN DBO.FX_PARAMETRO('CAMBIO_NA_MOEDA_PADRAO') = '.T.' THEN 1 ELSE -1 END ) * -1 ) ) ) AS NUMERIC(14, 2)) 
 AS TOTAL_MOEDA_ENTRADA, CAST((VALOR_TOTAL + VALOR_FRETE_TRANSPORTADORA + IMPORTACAO_IMPOSTO + IMPORTACAO_ICMS + 
 IMPORTACAO_IPI + IMPORTACAO_ALFANDEGA + IMPORTACAO_OUTRAS_DESPESAS + IMPORTACAO_FRETE + IMPORTACAO_SEGURO + 
 IMPORTACAO_DESEMBARACO ) AS NUMERIC(14, 2)) AS TOTAL_GERAL_ENTRADA, CAST(0 AS NUMERIC(8, 2)) AS PORC_TOTAL_GERAL, 
 ENTRADAS.CTB_LANCAMENTO, ENTRADAS.CTB_ITEM, ENTRADAS.TIPO_VOLUME, ENTRADAS.RATEIO_FILIAL, 
 CTB_FILIAL_RATEIO.DESC_RATEIO_FILIAL, ENTRADAS.RATEIO_CENTRO_CUSTO, CTB_CENTRO_CUSTO_RATEIO.DESC_RATEIO_CENTRO_CUSTO, 
 ENTRADAS.COMPRIMENTO_DE_ROLOS, ENTRADAS.DATA_FATURAMENTO_RELATIVO, ENTRADAS.UTILIZA_DIAS_FIXOS_FORNECEDOR, 
 ENTRADAS.NOME_CLIFOR_TRIANGULAR, ENTRADAS.SERIE_NF, SERIES_NF.DESCRICAO, ENTRADAS.NUMERO_CONFERENCIA, 
 ENTRADAS.NUMERO_ENTRADA, ENTRADAS.FATURA_NOME_CLIFOR, ENTRADAS.FATURA_SERIE, ENTRADAS.FATURA_NUMERO, 
 ENTRADAS.MARCA_EXPORTACAO, ENTRADAS.ATUALIZACAO_EXPORTAR, ENTRADAS.DATA_EXPORTACAO, ENTRADAS.STATUS_TRANSITO, 
 FILIAIS.EMPRESA, ENTRADAS.DIFERENCA_VALOR, ENTRADAS.FRETE, ENTRADAS.SEGURO, ENTRADAS.DESCONTO, ENTRADAS.ENCARGO, 
 ENTRADAS.QTDE_TOTAL, ENTRADAS.QTDE_TOTAL_AUX, ENTRADAS.VALOR_TOTAL, ENTRADAS.DEVOLUCAO, ENTRADAS.FRETE_A_PAGAR, 
 ENTRADAS.IMPORTACAO_IMPOSTO, ENTRADAS.IMPORTACAO_ICMS, ENTRADAS.IMPORTACAO_IPI, ENTRADAS.IMPORTACAO_ALFANDEGA, 
 ENTRADAS.IMPORTACAO_OUTRAS_DESPESAS, ENTRADAS.IMPORTACAO_FRETE, ENTRADAS.IMPORTACAO_SEGURO, ENTRADAS.IMPORTACAO_DESEMBARACO, 
 ENTRADAS.PESO, ENTRADAS.PESO_BRUTO, ENTRADAS.PORC_DESCONTO, ENTRADAS.PORC_ENCARGO, ENTRADAS.COMISSAO_VALOR, 
 ENTRADAS.COMISSAO_VALOR_GERENTE, ENTRADAS.PORC_DESCONTO_DIGITADO, ENTRADAS.VALOR_IMPOSTO_AGREGAR, ENTRADAS.VALOR_SUB_ITENS, 
 ENTRADAS.VALOR_FRETE_TRANSPORTADORA, ENTRADAS.CAMBIO_NA_DATA, ENTRADAS.ITEM_DIGITADO, CONVERT(BIT, 0) AS 
 SEQUENCIAL_POR_FILIAL, ENTRADAS.FILIAL_SAIDA, ENTRADAS.NF_SAIDA, ENTRADAS.SERIE_NF_SAIDA, 
 CTB_LX_TIPO_OPERACAO.GERA_FINANCEIRO, NATUREZAS_ENTRADAS.LX_TIPO_LANCAMENTO, ISNULL(FILIAIS.MATRIZ_FISCAL, FILIAIS.FILIAL) 
 AS FILIAL_MATRIZ_FISCAL, ISNULL(FILIAIS.MATRIZ, FILIAIS.FILIAL) AS FILIAL_MATRIZ_CONTABIL, CADASTRO_CLI_FOR.INDICA_FILIAL, 
 ENTRADAS.ESPECIE_SERIE, CTB_ESPECIE_SERIE.DESC_ESPECIE_SERIE, ENTRADAS.VALOR_CANCELADO, ENTRADAS.QTDE_CANCELADA, 
 ENTRADAS.DATA_CANCELAMENTO, ENTRADAS.NOTA_CANCELADA, ENTRADAS.NOTA_COMPLEMENTAR, FILIAIS_COBRANCA.COD_FILIAL AS 
 COD_FILIAL_COBRANCA, ENTRADAS.COD_CLIFOR_SACADO, SACADO.NOME_CLIFOR AS NOME_SACADO, ENTRADAS.IMPORTACAO_TX_CAPATAZIA, 
 ENTRADAS.SEQUENCIAL_UNICO, ENTRADAS.DATA_GERACAO_NSU, CAST((CASE WHEN ISNULL(ENTRADAS.CODIGO_CLIENTE_VAREJO, '''') = '''' 
 THEN 0 ELSE 1 END ) AS BIT) AS UTILIZA_CLIENTE_VAREJO, ENTRADAS.CODIGO_CLIENTE_VAREJO, CLIENTES_VAREJO.CLIENTE_VAREJO, 
 ENTRADAS.PROTOCOLO_AUTORIZACAO_NFE, ENTRADAS.STATUS_NFE, ENTRADAS.CHAVE_NFE, ENTRADAS.LOG_STATUS_NFE, 
 ENTRADAS.MOTIVO_CANCELAMENTO_NFE, ENTRADAS.PRIORIZACAO, ENTRADAS.TIPO_EMISSAO_NFE, ENTRADAS.FIN_EMISSAO_NFE, 
 ENTRADAS.DATA_AUTORIZACAO_NFE, ENTRADAS.REGISTRO_DPEC, ENTRADAS.DATA_REGISTRO_DPEC, ENTRADAS.PROTOCOLO_CANCELAMENTO_NFE, 
 ENTRADAS.OBS_INTERESSE_FISCO, ENTRADAS.CFOP_CANCELAMENTO, CTB_ESPECIE_SERIE.NUMERO_MODELO_FISCAL, ENTRADAS.DATA_CONTINGENCIA, 
 ENTRADAS.JUSTIFICATIVA_CONTINGENCIA, CLIENTES_VAREJO.PF_PJ AS CV_PF_PJ, CLIENTES_VAREJO.CPF_CGC AS CV_CPF_CGC, 
 CLIENTES_VAREJO.RG_IE AS CV_RG_IE, CLIENTES_VAREJO.ENDERECO AS CV_ENDERECO, CLIENTES_VAREJO.NUMERO AS CV_NUMERO, 
 CLIENTES_VAREJO.COMPLEMENTO AS CV_COMPLEMENTO, CLIENTES_VAREJO.BAIRRO AS CV_BAIRRO, CLIENTES_VAREJO.CIDADE AS CV_CIDADE, 
 CLIENTES_VAREJO.UF AS CV_UF, CLIENTES_VAREJO.TELEFONE AS CV_TELEFONE, CLIENTES_VAREJO.CEP AS CV_CEP, 
 CLIENTES_VAREJO.PAIS AS CV_PAIS, ENTRADAS.IND_NAT_FRT, ENTRADAS.VEICULO_PLACA, ENTRADAS.MARCA_VOLUMES, 
 ENTRADAS.NUMERACAO_VOLUMES, ENTRADAS.UF_PLACA_VEICULO FROM ENTRADAS INNER JOIN CADASTRO_CLI_FOR 
 ON ENTRADAS.NOME_CLIFOR = CADASTRO_CLI_FOR.NOME_CLIFOR INNER JOIN CADASTRO_CLI_FOR AS SACADO 
 ON ENTRADAS.COD_CLIFOR_SACADO = SACADO.COD_CLIFOR INNER JOIN FILIAIS ON ENTRADAS.FILIAL = FILIAIS.FILIAL 
 LEFT JOIN CADASTRO_CLI_FOR AS CADASTRO_CLI_FOR_A ON FILIAIS.FILIAL = CADASTRO_CLI_FOR_A.NOME_CLIFOR INNER JOIN 
 NATUREZAS_ENTRADAS ON ENTRADAS.NATUREZA = NATUREZAS_ENTRADAS.NATUREZA INNER JOIN CTB_LX_TIPO_OPERACAO ON 
 CTB_LX_TIPO_OPERACAO.CTB_TIPO_OPERACAO = NATUREZAS_ENTRADAS.CTB_TIPO_OPERACAO INNER JOIN COND_ENT_PGTOS ON 
 ENTRADAS.CONDICAO_PGTO = COND_ENT_PGTOS.CONDICAO_PGTO LEFT JOIN SERIES_NF ON ENTRADAS.SERIE_NF = SERIES_NF.SERIE_NF 
 LEFT JOIN CTB_FILIAL_RATEIO ON ENTRADAS.RATEIO_FILIAL = CTB_FILIAL_RATEIO.RATEIO_FILIAL 
 LEFT JOIN CTB_CENTRO_CUSTO_RATEIO ON ENTRADAS.RATEIO_CENTRO_CUSTO = CTB_CENTRO_CUSTO_RATEIO.RATEIO_CENTRO_CUSTO 
 LEFT JOIN CTB_LX_INDICADOR_FISCAL_TERCEIRO ON CADASTRO_CLI_FOR.INDICADOR_FISCAL_TERCEIRO = CTB_LX_INDICADOR_FISCAL_TERCEIRO.INDICADOR_FISCAL_TERCEIRO LEFT JOIN FILIAIS AS FILIAIS_COBRANCA ON ENTRADAS.FILIAL_COBRANCA = FILIAIS_COBRANCA.FILIAL LEFT JOIN CTB_ESPECIE_SERIE ON CTB_ESPECIE_SERIE.ESPECIE_SERIE = ENTRADAS.ESPECIE_SERIE LEFT JOIN CLIENTES_VAREJO ON ENTRADAS.CODIGO_CLIENTE_VAREJO = CLIENTES_VAREJO.CODIGO_CLIENTE WHERE cod_transacao = 'ENTRADAS_102' and (ENTRADAS.RECEBIMENTO >= '20130301' AND ENTRADAS.RECEBIMENTO <= '20130630') AND ENTRADAS.NATUREZA = '250.01'



exec sp_executesql N'
/* lx005102spk  CursorAdapter: CUR_V_ENTRADAS_00_SAIDA_DEVOLUCAO(Alias: v_entradas_00_saida_devolucao)  */
SELECT FATURAMENTO_ENTRADA_DEVOLUCAO.FILIAL, FATURAMENTO_ENTRADA_DEVOLUCAO.NF_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF, FATURAMENTO_ENTRADA_DEVOLUCAO.ITEM_IMPRESSAO_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.SUB_ITEM_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.NOME_CLIFOR, FATURAMENTO_ENTRADA_DEVOLUCAO.NF_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.ITEM_IMPRESSAO_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.SUB_ITEM_ENTRADA, FATURAMENTO_ENTRADA_DEVOLUCAO.ORIGEM_ENTRADA_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.QTDE_DEVOLVIDA, QTDE_DISPONIVEL=(FATURAMENTO_ITEM.QTDE_ITEM-FATURAMENTO_ITEM.QTDE_DEVOLVIDA), FATURAMENTO.EMISSAO, FATURAMENTO_ITEM.CODIGO_ITEM, FATURAMENTO_ITEM.DESCRICAO_ITEM, FATURAMENTO_ITEM.MPADRAO_PRECO_UNITARIO AS PRECO_UNITARIO, FATURAMENTO_ITEM.DESCONTO_ITEM, FATURAMENTO_ITEM.UNIDADE, VALOR = (FATURAMENTO_ENTRADA_DEVOLUCAO.QTDE_DEVOLVIDA*FATURAMENTO_ITEM.MPADRAO_PRECO_UNITARIO), FATURAMENTO_ITEM.CLASSIF_FISCAL, FATURAMENTO_ITEM.TRIBUT_ORIGEM, FATURAMENTO_ITEM.TRIBUT_ORIGEM, FATURAMENTO_ITEM.CONTA_CONTABIL, FATURAMENTO_ITEM.INDICADOR_CFOP, FATURAMENTO_ITEM.TRIBUT_ICMS, FATURAMENTO_ITEM.UNIDADE, CONVERT(DECIMAL, 1) AS FATOR_CONVERSAO_UNIDADE, DBO.FX_PRODUCAO_PRECO(CAST((DBO.FX_PRODUCAO_PRECO(FATURAMENTO_ITEM.TIMESTAMP, ''F'') * POWER((CASE WHEN ISNULL(FATURAMENTO.CAMBIO_NA_DATA, 0) = 0 THEN 1 ELSE FATURAMENTO.CAMBIO_NA_DATA END ),(CASE WHEN DBO.FX_PARAMETRO(''CAMBIO_NA_MOEDA_PADRAO'') = ''.F.'' THEN -1 ELSE 1 END )) )AS NUMERIC(14,2)), ''T'') AS TIMESTAMP, FATURAMENTO_ITEM.COMISSAO_ITEM, FATURAMENTO_ITEM.COMISSAO_ITEM_GERENTE, REPRESENTANTES.COD_REPRESENTANTE, REPRESENTANTES2.COD_REPRESENTANTE AS COD_REPRESENTANTE_GERENTE, FATURAMENTO_ITEM.REFERENCIA, FATURAMENTO_ITEM.REFERENCIA_ITEM, FATURAMENTO_ITEM.REFERENCIA_PEDIDO, TRIBUT_ICMS.DESCRICAO AS TRIBUT_ICMS_DESCRICAO, TRIBUT_ORIGEM.DESCRICAO AS TRIBUT_ORIGEM_DESCRICAO, CTB_CONTA_PLANO.DESC_CONTA, CLASSIF_FISCAL.DESC_CLASSIFICACAO, CTB_LX_INDICADOR_CFOP.DESCRICAO_INDICADOR_CFOP, FATURAMENTO.PORC_ENCARGO, FATURAMENTO.PORC_DESCONTO, CONVERT(BIT, 1) AS PORC_DESCONTO_DIGITADO, FATURAMENTO.CODIGO_LOCAL_ENTREGA, FATURAMENTO.NOME_CLIFOR_ENTREGA, FATURAMENTO.REPRESENTANTE, FATURAMENTO.GERENTE, FATURAMENTO_ITEM.FAIXA, FATURAMENTO_ITEM.COD_TABELA_FILHA, FATURAMENTO.AGRUPAMENTO_ITENS, CODIGO_FISCAL_OPERACAO = CTB_LX_NATUREZAS_OPERACAO.CFOP_RETORNO_DEVOLUCAO, FATURAMENTO_ITEM.ORIGEM_ITEM FROM FATURAMENTO_ENTRADA_DEVOLUCAO INNER JOIN FATURAMENTO_ITEM ON FATURAMENTO_ENTRADA_DEVOLUCAO.FILIAL = FATURAMENTO_ITEM.FILIAL AND FATURAMENTO_ENTRADA_DEVOLUCAO.NF_SAIDA = FATURAMENTO_ITEM.NF_SAIDA AND FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF = FATURAMENTO_ITEM.SERIE_NF AND FATURAMENTO_ENTRADA_DEVOLUCAO.ITEM_IMPRESSAO_SAIDA = FATURAMENTO_ITEM.ITEM_IMPRESSAO AND FATURAMENTO_ENTRADA_DEVOLUCAO.SUB_ITEM_SAIDA = FATURAMENTO_ITEM.SUB_ITEM_TAMANHO INNER JOIN FATURAMENTO ON FATURAMENTO_ITEM.FILIAL = FATURAMENTO.FILIAL AND FATURAMENTO_ITEM.NF_SAIDA = FATURAMENTO.NF_SAIDA AND FATURAMENTO_ITEM.SERIE_NF = FATURAMENTO.SERIE_NF INNER JOIN TRIBUT_ICMS ON FATURAMENTO_ITEM.TRIBUT_ICMS = TRIBUT_ICMS.TRIBUT_ICMS INNER JOIN CTB_LX_INDICADOR_CFOP ON FATURAMENTO_ITEM.INDICADOR_CFOP = CTB_LX_INDICADOR_CFOP.INDICADOR_CFOP INNER JOIN CLASSIF_FISCAL ON FATURAMENTO_ITEM.CLASSIF_FISCAL = CLASSIF_FISCAL.CLASSIF_FISCAL INNER JOIN TRIBUT_ORIGEM ON TRIBUT_ORIGEM.TRIBUT_ORIGEM = FATURAMENTO_ITEM.TRIBUT_ORIGEM INNER JOIN CTB_LX_NATUREZAS_OPERACAO ON CTB_LX_NATUREZAS_OPERACAO.CODIGO_FISCAL_OPERACAO = FATURAMENTO_ITEM.CODIGO_FISCAL_OPERACAO LEFT JOIN CTB_CONTA_PLANO ON FATURAMENTO_ITEM.CONTA_CONTABIL = CTB_CONTA_PLANO.CONTA_CONTABIL LEFT JOIN REPRESENTANTES ON FATURAMENTO.REPRESENTANTE = REPRESENTANTES.REPRESENTANTE LEFT JOIN REPRESENTANTES REPRESENTANTES2 ON FATURAMENTO.GERENTE = REPRESENTANTES2.REPRESENTANTE WHERE FATURAMENTO_ENTRADA_DEVOLUCAO.NF_ENTRADA = @P1 AND FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF_ENTRADA = @P2 AND FATURAMENTO_ENTRADA_DEVOLUCAO.NOME_CLIFOR = @P3 ORDER BY FATURAMENTO_ENTRADA_DEVOLUCAO.FILIAL, FATURAMENTO_ENTRADA_DEVOLUCAO.NF_SAIDA, FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF',N'@P1 varchar(9),@P2 varchar(1),@P3 varchar(9)','000004189','2','Dafiti SP'


select * from FATURAMENTO_ENTRADA_DEVOLUCAO


SELECT FATURAMENTO_ENTRADA_DEVOLUCAO.*,ENTRADAS.* FROM FATURAMENTO_ENTRADA_DEVOLUCAO
JOIN ENTRADAS ON ENTRADAS.NF_ENTRADA=FATURAMENTO_ENTRADA_DEVOLUCAO.NF_ENTRADA 
AND ENTRADAS.SERIE_NF_ENTRADA=FATURAMENTO_ENTRADA_DEVOLUCAO.SERIE_NF_ENTRADA
WHERE ENTRADAS.NATUREZA = '250.01' AND cod_transacao = 'ENTRADAS_102' 
AND ENTRADAS.RECEBIMENTO>='20130301' AND ENTRADAS.RECEBIMENTO <= '20130630' 
--AND ENTRADAS.NF_ENTRADA='001745'

 