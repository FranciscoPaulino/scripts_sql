SELECT * FROM MATERIAIS_FORNECEDOR
WHERE FORNECEDOR='LDR' AND REF_FORNECEDOR='01.02.0113'


SELECT B.MATERIAL,B.COR_MATERIAL, A.*
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
JOIN MATERIAIS_FORNECEDOR B ON A.MATERIAL=B.REF_FORNECEDOR AND A.COR_MATERIAL=B.REF_COR_FORNECEDOR
WHERE B.FORNECEDOR='LDR' AND A.QTDE_ESTOQUE>0 AND A.FILIAL='DR VAREJO'


SELECT B.MATERIAL,B.COR_MATERIAL, A.*
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
JOIN MATERIAIS_FORNECEDOR B ON A.MATERIAL=B.REF_FORNECEDOR AND A.COR_MATERIAL=B.REF_COR_FORNECEDOR
WHERE B.FORNECEDOR='LDR' AND A.QTDE_ESTOQUE>0 AND A.FILIAL='DR VAREJO'


SELECT * FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
WHERE A.FILIAL='DR VAREJO' AND A.QTDE_ESTOQUE>0 



SELECT * 
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS
WHERE FILIAL='DR VAREJO' AND QTDE_ESTOQUE>0 AND MATERIAL='70.06.0068'


SELECT SUM(QTDE_ESTOQUE) 
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS
WHERE FILIAL='DR VAREJO' AND QTDE_ESTOQUE>0




SELECT * 
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS
WHERE FILIAL='DR VAREJO' AND QTDE_ESTOQUE>0 AND MATERIAL='70.06.0068'



--- DIFERENÇAS DE ESTOQUE LDR X DR
SELECT C.MATERIAL AS MATERIAL_DR,C.COR_MATERIAL AS COR_MATERIAL_DR,A.MATERIAL AS MATERIAL_LDR,A.COR_MATERIAL AS MATERIAL_LDR,D.DESC_MATERIAL,D.UNID_ESTOQUE,
SUM(A.QTDE_ESTOQUE) AS ESTOQUE_LDR,SUM(C.QTDE_ESTOQUE) AS ESTOQUE_DR
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
JOIN MATERIAIS_FORNECEDOR B ON A.MATERIAL=B.REF_FORNECEDOR AND A.COR_MATERIAL=B.REF_COR_FORNECEDOR
JOIN ESTOQUE_MATERIAIS C ON C.MATERIAL=B.MATERIAL AND C.COR_MATERIAL=B.COR_MATERIAL AND C.FILIAL='DR VAREJO'
JOIN MATERIAIS D ON D.MATERIAL=C.MATERIAL
WHERE B.FORNECEDOR='LDR' AND A.QTDE_ESTOQUE>0 AND A.FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO')
GROUP BY C.MATERIAL,C.COR_MATERIAL,A.MATERIAL,A.COR_MATERIAL,D.DESC_MATERIAL,D.UNID_ESTOQUE
HAVING SUM(A.QTDE_ESTOQUE)<>SUM(C.QTDE_ESTOQUE)
ORDER BY C.MATERIAL




SELECT SUM(A.QTDE_ESTOQUE)
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
JOIN MATERIAIS_FORNECEDOR B ON A.MATERIAL=B.REF_FORNECEDOR AND A.COR_MATERIAL=B.REF_COR_FORNECEDOR
WHERE B.FORNECEDOR='LDR' AND A.QTDE_ESTOQUE>0 AND A.FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO') --AND A.MATERIAL='70.06.0068'


SELECT SUM(QTDE_ESTOQUE) 
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS
WHERE FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO') AND QTDE_ESTOQUE>0


SELECT A.*
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
JOIN MATERIAIS_FORNECEDOR B ON A.MATERIAL=B.REF_FORNECEDOR AND A.COR_MATERIAL=B.REF_COR_FORNECEDOR
WHERE B.FORNECEDOR='LDR' AND A.QTDE_ESTOQUE>0 AND FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO') 


SELECT MATERIAL,COR_MATERIAL,QTDE_ESTOQUE=SUM(QTDE_ESTOQUE) INTO #MATERIAIS_CORES_ESTOQUE
FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS
WHERE FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO') AND QTDE_ESTOQUE>0
GROUP BY MATERIAL,COR_MATERIAL


SELECT DISTINCT MATERIAL,COR_MATERIA FROM #MATERIAIS_CORES_ESTOQUE A
JOIN MATERIAIS_FORNECEDOR B ON 
A.MATERIAL=B.REF_FORNECEDOR AND 
A.COR_MATERIAL=B.REF_COR_FORNECEDOR



SELECT A.REF_FORNECEDOR, B.MATERIAL, COUNT(*) 
FROM MATERIAIS_FORNECEDOR A
JOIN MATERIAIS_FORNECEDOR B ON B.REF_FORNECEDOR=A.REF_FORNECEDOR AND B.REF_COR_FORNECEDOR=A.REF_COR_FORNECEDOR
WHERE A.REF_FORNECEDOR='50.07.0131'
GROUP BY A.REF_FORNECEDOR, B.MATERIAL


SELECT A.REF_FORNECEDOR,A.MATERIAL, COUNT(*) 
FROM MATERIAIS_FORNECEDOR A
JOIN MATERIAIS_FORNECEDOR B ON B.REF_FORNECEDOR=A.REF_FORNECEDOR AND B.REF_COR_FORNECEDOR=A.REF_COR_FORNECEDOR
WHERE A.FORNECEDOR='LDR'
GROUP BY A.REF_FORNECEDOR,A.MATERIAL
HAVING COUNT(*)>1
order by REF_FORNECEDOR

 

---- MATERIAS QUE FALTAM DE-PARA
SELECT '' AS MATERIAL_DR,'' AS COR_DR, A.MATERIAL,A.COR_MATERIAL,B.DESC_MATERIAL FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
left JOIN LDR.DRVAREJO.DBO.MATERIAIS B ON B.MATERIAL=A.MATERIAL
WHERE A.FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO','FORA DE LINHA') AND A.QTDE_ESTOQUE>0 AND RTRIM(A.MATERIAL)+RTRIM(A.COR_MATERIAL) 
NOT IN(SELECT RTRIM(REF_FORNECEDOR)+RTRIM(REF_COR_FORNECEDOR) FROM MATERIAIS_FORNECEDOR WHERE FORNECEDOR='LDR')
ORDER BY A.MATERIAL,A.COR_MATERIAL




---- MATERIAS QUE FALTAM DE-PARA
SELECT '' AS MATERIAL_DR,'' AS COR_DR, A.MATERIAL,A.COR_MATERIAL,B.DESC_MATERIAL FROM LDR.DRVAREJO.DBO.ESTOQUE_MATERIAIS A
left JOIN LDR.DRVAREJO.DBO.MATERIAIS B ON B.MATERIAL=A.MATERIAL
WHERE A.FILIAL IN ('DR VAREJO','ESTOQUE EM TRANSICAO','FORA DE LINHA') AND A.QTDE_ESTOQUE>0 AND RTRIM(A.MATERIAL)+RTRIM(A.COR_MATERIAL) 
NOT IN(SELECT RTRIM(REF_FORNECEDOR)+RTRIM(REF_COR_FORNECEDOR) FROM MATERIAIS_FORNECEDOR WHERE FORNECEDOR='LDR')
ORDER BY A.MATERIAL,A.COR_MATERIAL




SELECT * FROM ESTOQUE_SAI_MAT
WHERE FILIAL='DR VAREJO' AND 
REQ_MATERIAL IN(
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853283',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853283',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475'
)


BEGIN TRAN

DELETE FROM ESTOQUE_SAI_MAT
WHERE FILIAL='DR VAREJO' AND 
REQ_MATERIAL IN(
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853283',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853283',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853198',  
'853229',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853391',  
'853410',  
'853442',  
'853442',  
'853465',  
'853465',  
'853475',  
'853197',  
'853198',  
'853229',  
'853267',  
'853267',  
'853283',  
'853291',  
'853291',  
'853391',  
'853391',  
'853410',  
'853410',  
'853442',  
'853465',  
'853465',  
'853475'
)
COMMIT


SELECT DISTINCT REQ_MATERIAL FROM ESTOQUE_RET1_MAT
WHERE FILIAL='DR VAREJO'


DELETE FROM ESTOQUE_RET_MAT
WHERE FILIAL='DR VAREJO' AND REQ_MATERIAL IN(
'328030',  
'328032',  
'328034',  
'328039',  
'328040',  
'328042',  
'328043',  
'328045',  
'328047',  
'328048',  
'328050',  
'328051',  
'328052',  
'328054',  
'328056',  
'328057',  
'328059',  
'328060',  
'328061',  
'328062',  
'328063',  
'328065',  
'328066',  
'328067',  
'328068',  
'328070',  
'328071',  
'328072',  
'328073',  
'328074',  
'328075',  
'328076',  
'328077',  
'328078',  
'328080',  
'328081',  
'328083',  
'328084',  
'328085',  
'328086',  
'328087',  
'328088',  
'328089',  
'328090',  
'328091',  
'328092',  
'328093',  
'328094',  
'328095',  
'328096',  
'328097',  
'328098',  
'328101',  
'328102',  
'328104',  
'328105',  
'328107',  
'328110',  
'328111',  
'328114',  
'328115',  
'328116',  
'328117',  
'328118',  
'328119',  
'328120',  
'328121',  
'328122',  
'328123',  
'328124',  
'328125',  
'328126',  
'328127',  
'328130',  
'328131',  
'328133',  
'328135',  
'328136',  
'328137',  
'328139',  
'328140',  
'328141',  
'328142',  
'328144',  
'328145',  
'328146',  
'328147',  
'328148',  
'328149',  
'328150',  
'328152',  
'328153',  
'328154',  
'328155',  
'328156',  
'328158',  
'328159',  
'328160',  
'328161',  
'328162',  
'328163',  
'328164',  
'328165',  
'328166',  
'328168',  
'328169',  
'328170',  
'328171',  
'328175',  
'328412',  
'328528',  
'328531',  
'328561',  
'328627',  
'328630',  
'328635',  
'328638')


SELECT * FROM ESTOQUE_MATE