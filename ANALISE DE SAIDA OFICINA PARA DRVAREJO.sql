exec sp_executesql N'
/* lx100107spk  CursorAdapter: cur_v_faturamento_05_producao_os(Alias: v_faturamento_05_producao_os)  */
SELECT PRODUCAO_ORDEM_SERVICO.ORDEM_SERVICO,  PRODUCAO_ORDEM_SERVICO.RECURSO_PRODUTIVO,  PRODUCAO_ORDEM_SERVICO.FASE_PRODUCAO, PRODUCAO_ORDEM_SERVICO.DATA,  PRODUCAO_ORDEM_SERVICO.SETOR_PRODUCAO,  PRODUCAO_ORDEM_SERVICO.CONFERIDO_POR,  PRODUCAO_ORDEM_SERVICO.OBSERVACAO, PRODUCAO_FASE.DESC_FASE_PRODUCAO,  PRODUCAO_SETOR.DESC_SETOR_PRODUCAO, PRODUCAO_RECURSOS.TIPO_RECURSO,  PRODUCAO_RECURSOS.DESC_RECURSO, PRODUCAO_RECURSOS.RECURSO_PROPRIO,  PRODUCAO_ORDEM_SERVICO.ORDEM_SERVICO_PARALELA,  PRODUCAO_ORDEM_SERVICO.FILIAL, PRODUCAO_ORDEM_SERVICO.NF_SAIDA,  PRODUCAO_ORDEM_SERVICO.SERIE_NF, PRODUCAO_ORDEM_SERVICO.NF_ENTRADA,  PRODUCAO_ORDEM_SERVICO.INDICADOR_TIPO_MOV,  PRODUCAO_ORDEM_SERVICO.SEGUNDA_QUALIDADE, SPACE(5) AS RECURSO_ORIGEM,  SPACE(40) AS DESC_REC_ORIGEM, PRODUCAO_ORDEM_SERVICO.ACERTO_ENTRADA,  FILIAIS.EMPRESA FROM DBO.PRODUCAO_ORDEM_SERVICO PRODUCAO_ORDEM_SERVICO,  DBO.PRODUCAO_FASE PRODUCAO_FASE, DBO.PRODUCAO_SETOR PRODUCAO_SETOR,  DBO.PRODUCAO_RECURSOS PRODUCAO_RECURSOS, DBO.FILIAIS FILIAIS WHERE  producao_recursos.nome_clifor = @P1  and (producao_ordem_servico.serie_nf is null or producao_ordem_servico.serie_nf = '''')  and (producao_ordem_servico.nf_saida is null or producao_ordem_servico.nf_saida = '''')  and producao_ordem_servico.indicador_tipo_mov not in (2 ,4)  AND PRODUCAO_FASE.FASE_PRODUCAO = PRODUCAO_ORDEM_SERVICO.FASE_PRODUCAO   AND PRODUCAO_ORDEM_SERVICO.FASE_PRODUCAO = PRODUCAO_SETOR.FASE_PRODUCAO   AND PRODUCAO_ORDEM_SERVICO.SETOR_PRODUCAO = PRODUCAO_SETOR.SETOR_PRODUCAO   AND PRODUCAO_ORDEM_SERVICO.RECURSO_PRODUTIVO = PRODUCAO_RECURSOS.RECURSO_PRODUTIVO   AND PRODUCAO_ORDEM_SERVICO.FILIAL = FILIAIS.FILIAL ORDER BY PRODUCAO_ORDEM_SERVICO.ORDEM_SERVICO,  PRODUCAO_ORDEM_SERVICO.DATA',N'@P1 varchar(5)','ELITE'

exec sp_executesql N'
/* lx100107spk  CursorAdapter: cur_v_faturamento_05_estoque_sai_mat(Alias: v_faturamento_05_estoque_sai_mat)  */
SELECT ESTOQUE_SAI_MAT.REQ_MATERIAL, ESTOQUE_SAI_MAT.FILIAL,  ESTOQUE_SAI_MAT.ORDEM_SERVICO, ESTOQUE_SAI_MAT.SAIDA_POR_PECA,  ESTOQUE_SAI_MAT.EMISSAO, ESTOQUE_SAI_MAT.RESPONSAVEL,  ESTOQUE_SAI_MAT.DESTINO, ESTOQUE_SAI_MAT.OBS,  ESTOQUE_SAI_MAT.REQUISITANTE, ESTOQUE_SAI_MAT.FASE_PRODUCAO,  ESTOQUE_SAI_MAT.FORNECEDOR, ESTOQUE_SAI_MAT.CENTRO_CUSTO,  ESTOQUE_SAI_MAT.TIPO_MOVIMENTACAO, ESTOQUE_SAI_MAT.NF_ENTRADA,  ESTOQUE_SAI_MAT.NOME_CLIFOR, ESTOQUE_SAI_MAT.FILIAL_FATURAMENTO,  ESTOQUE_SAI_MAT.SERIE_NF, ESTOQUE_SAI_MAT.NF_SAIDA,  ESTOQUE_SAI_MAT.FILIAL_DESTINO, ESTOQUE_SAI_MAT.REQ_MATERIAL_DESTINO,  ESTOQUE_SAI_MAT.PEDIDO, ESTOQUE_SAI_MAT.NUMERO_EMBALAGEM,  ESTOQUE_SAI_MAT.PESO_LIQUIDO, ESTOQUE_SAI_MAT.PESO_BRUTO,  ESTOQUE_SAI_MAT.DIMENSOES_EMBALAGEM, FILIAIS.EMPRESA FROM ESTOQUE_SAI_MAT ESTOQUE_SAI_MAT, DBO.FILIAIS FILIAIS WHERE  estoque_sai_mat.filial = @P1 and estoque_sai_mat.filial_faturamento is null  and estoque_sai_mat.serie_nf is null and nf_saida is null  and estoque_sai_mat.nf_entrada is null   and estoque_sai_mat.pedido is null and estoque_sai_mat.nf_pendente = 1  and ((estoque_sai_mat.nome_clifor = @P2) or (estoque_sai_mat.nome_clifor is null))  AND FILIAIS.FILIAL = ESTOQUE_SAI_MAT.FILIAL',N'@P1 varchar(9),@P2 varchar(5)','DR VAREJO','ELITE'

exec sp_executesql N'
/* lx100107spk  CursorAdapter: cur_v_faturamento_05_os_valida(Alias: v_faturamento_05_os_valida)  */
SELECT PRODUCAO_OS_TAREFAS.TAREFA, PRODUCAO_OS_TAREFAS.ORDEM_SERVICO, PRODUCAO_OS_TAREFAS.ORDEM_PRODUCAO, PRODUCAO_ORDEM.ORDEM_CORTE, PRODUCAO_OS_TAREFAS.PRODUTO, 
PRODUCAO_OS_TAREFAS.COR_PRODUTO,  CUSTO_PREVISTO, DESC_PRODUTO, PRODUTOS.CLASSIF_FISCAL CLASSIF_PRODUTO,  PRODUTOS.MATERIAL, MATERIAIS.CLASSIF_FISCAL CLASSIF_MATERIAL, SUM(QTDE_O) QTDE,  
PRODUTOS.PESO, PRODUTOS.TRIBUT_ORIGEM TRIBUT_ORIGEM_PROD, PRODUTOS.TRIBUT_ICMS TRIBUT_ICMS_PROD, MATERIAIS.TRIBUT_ORIGEM TRIBUT_ORIGEM_MAT,  MATERIAIS.TRIBUT_ICMS TRIBUT_ICMS_MAT, 
MATERIAIS.DESC_MATERIAL,  PRODUTOS.UNIDADE, MATERIAIS.COMPRIMENTO, MATERIAIS.UNID_ESTOQUE AS UNIDADE_MAT, CUSTO_REPOSICAO=CASE WHEN ISNULL(MATERIAIS_CORES.CUSTO_REPOSICAO,0)=0 THEN 
PRODUTO_CORES.CUSTO_REPOSICAO1 ELSE MATERIAIS_CORES.CUSTO_REPOSICAO END,  CLASSIF_FISCAL.IPI IPI_PROD, B.IPI IPI_MAT,  ISNULL(PRODUTOS_INDICADOR_CFOP.INDICADOR_CFOP, CASE WHEN 
ISNULL(FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, 0) = 1 AND PRODUTOS.INDICADOR_CFOP = 10 THEN 11 ELSE PRODUTOS.INDICADOR_CFOP END) AS CFOP_PRODUTO,  ISNULL(PRODUTOS_INDICADOR_CFOP.INDICADOR_CFOP, 
CASE WHEN ISNULL(FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, 0) = 1 AND PRODUTOS.INDICADOR_CFOP = 10 THEN 11 ELSE PRODUTOS.INDICADOR_CFOP END) AS INDICADOR_CFOP,  
CTB_LX_INDICADOR_CFOP.DESCRICAO_INDICADOR_CFOP,  ISNULL(MATERIAIS_INDICADOR_CFOP.INDICADOR_CFOP, CASE WHEN ISNULL(FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, 0) = 1 AND MATERIAIS.INDICADOR_CFOP = 
10 THEN 11 ELSE MATERIAIS.INDICADOR_CFOP END) AS CFOP_MATERIAL,  CTB_LX_INDICADOR_CFOP.DESCRICAO_INDICADOR_CFOP AS DESCRICAO_CFOP_PRODUTO,   CTB_LX_INDICADOR_CFOP1.DESCRICAO_INDICADOR_CFOP 
AS DESCRICAO_CFOP_MATERIAL , CONVERT(VARCHAR(4),'''') CODIGO_FISCAL_OPERACAO , SUM(QTDE_O) AS QUANTIDADE, COD_TABELA_FILHA=''M'',  TRIBUT_ICMS.DESCRICAO AS TRIBUT_ICMS_DESCRICAO_MAT, TRIBUT_ICMS2.DESCRICAO AS TRIBUT_ICMS_DESCRICAO_PROD, TRIBUT_ORIGEM.DESCRICAO AS TRIBUT_ORIGEM_DESCRICAO_MAT, TRIBUT_ORIGEM2.DESCRICAO AS TRIBUT_ORIGEM_DESCRICAO, CLASSIF_FISCAL.DESC_CLASSIFICACAO DESC_CLASSIFICACAO_PROD, B.DESC_CLASSIFICACAO DESC_CLASSIFICACAO_MAT, CONVERT(NUMERIC(11,2),0) AS TIMESTAMP,PRODUTOS.CONTA_CONTABIL CONTA_CONTABIL_PROD,MATERIAIS.CONTA_CONTABIL CONTA_CONTABIL_MAT, FAIXA=''1'', GERAR_ITEM= CONVERT(BIT,0), CONVERT(VARCHAR(4),'''') ITEM_IMPRESSAO, CTB_CONTA_PLANO.DESC_CONTA DESC_CONTA_MAT, CTB_CONTA_PLANO2.DESC_CONTA DESC_CONTA_PROD  FROM PRODUTOS JOIN PRODUCAO_OS_TAREFAS ON (PRODUCAO_OS_TAREFAS.PRODUTO = PRODUTOS.PRODUTO) JOIN PRODUCAO_ORDEM ON PRODUCAO_OS_TAREFAS.ORDEM_PRODUCAO = PRODUCAO_ORDEM.ORDEM_PRODUCAO JOIN PRODUTO_CORES ON (PRODUTO_CORES.PRODUTO=PRODUCAO_OS_TAREFAS.PRODUTO AND PRODUTO_CORES.COR_PRODUTO=PRODUCAO_OS_TAREFAS.COR_PRODUTO)  JOIN CLASSIF_FISCAL  ON (PRODUTOS.CLASSIF_FISCAL = CLASSIF_FISCAL.CLASSIF_FISCAL )  LEFT JOIN MATERIAIS ON (PRODUTOS.MATERIAL = MATERIAIS.MATERIAL)    LEFT JOIN MATERIAIS_CORES ON (PRODUTO_CORES.MATERIAL = MATERIAIS_CORES.MATERIAL AND PRODUTO_CORES.COR_MATERIAL = MATERIAIS_CORES.COR_MATERIAL)   LEFT JOIN CLASSIF_FISCAL B ON MATERIAIS.CLASSIF_FISCAL = B.CLASSIF_FISCAL   LEFT JOIN TRIBUT_ICMS ON (MATERIAIS.TRIBUT_ICMS = TRIBUT_ICMS.TRIBUT_ICMS)   LEFT JOIN TRIBUT_ICMS TRIBUT_ICMS2 ON (PRODUTOS.TRIBUT_ICMS = TRIBUT_ICMS2.TRIBUT_ICMS)   LEFT JOIN TRIBUT_ORIGEM ON (MATERIAIS.TRIBUT_ORIGEM = TRIBUT_ORIGEM.TRIBUT_ORIGEM)  LEFT JOIN TRIBUT_ORIGEM TRIBUT_ORIGEM2 ON (PRODUTOS.TRIBUT_ORIGEM = TRIBUT_ORIGEM2.TRIBUT_ORIGEM)  LEFT JOIN CTB_CONTA_PLANO ON (MATERIAIS.CONTA_CONTABIL = CTB_CONTA_PLANO.CONTA_CONTABIL)  LEFT JOIN CTB_CONTA_PLANO CTB_CONTA_PLANO2 ON (PRODUTOS.CONTA_CONTABIL = CTB_CONTA_PLANO2.CONTA_CONTABIL)  JOIN FILIAIS ON FILIAIS.FILIAL = @P1 LEFT JOIN PRODUTOS_INDICADOR_CFOP ON PRODUTOS.PRODUTO = PRODUTOS_INDICADOR_CFOP.PRODUTO AND FILIAIS.FILIAL = PRODUTOS_INDICADOR_CFOP.FILIAL LEFT JOIN CTB_LX_INDICADOR_CFOP ON ISNULL(PRODUTOS_INDICADOR_CFOP.INDICADOR_CFOP, CASE WHEN ISNULL(FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, 0) = 1 AND PRODUTOS.INDICADOR_CFOP = 10 THEN 11 ELSE PRODUTOS.INDICADOR_CFOP END) = CTB_LX_INDICADOR_CFOP.INDICADOR_CFOP  LEFT JOIN MATERIAIS_INDICADOR_CFOP ON MATERIAIS.MATERIAL = MATERIAIS_INDICADOR_CFOP.MATERIAL AND FILIAIS.FILIAL = MATERIAIS_INDICADOR_CFOP.FILIAL LEFT JOIN CTB_LX_INDICADOR_CFOP CTB_LX_INDICADOR_CFOP1 ON (ISNULL(MATERIAIS_INDICADOR_CFOP.INDICADOR_CFOP, CASE WHEN ISNULL(FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, 0) = 1 AND MATERIAIS.INDICADOR_CFOP = 10 THEN 11 ELSE MATERIAIS.INDICADOR_CFOP END) = CTB_LX_INDICADOR_CFOP1.INDICADOR_CFOP )  WHERE ORDEM_SERVICO = @P2   GROUP BY PRODUCAO_OS_TAREFAS.TAREFA, PRODUCAO_OS_TAREFAS.ORDEM_SERVICO, PRODUCAO_OS_TAREFAS.ORDEM_PRODUCAO, PRODUCAO_ORDEM.ORDEM_CORTE, PRODUCAO_OS_TAREFAS.PRODUTO, PRODUCAO_OS_TAREFAS.COR_PRODUTO, CUSTO_PREVISTO, DESC_PRODUTO, PRODUTOS.CLASSIF_FISCAL, PRODUTOS.MATERIAL,  MATERIAIS.CLASSIF_FISCAL,PRODUTOS.PESO, PRODUTOS.TRIBUT_ORIGEM, PRODUTOS.TRIBUT_ICMS, MATERIAIS.TRIBUT_ORIGEM, MATERIAIS.TRIBUT_ICMS, MATERIAIS.DESC_MATERIAL, PRODUTOS.UNIDADE ,  MATERIAIS.COMPRIMENTO, MATERIAIS.UNID_ESTOQUE, MATERIAIS_CORES.CUSTO_REPOSICAO, PRODUTO_CORES.CUSTO_REPOSICAO1, CLASSIF_FISCAL.IPI, B.IPI,  PRODUTOS.INDICADOR_CFOP, MATERIAIS.INDICADOR_CFOP, CTB_LX_INDICADOR_CFOP.DESCRICAO_INDICADOR_CFOP, CTB_LX_INDICADOR_CFOP1.DESCRICAO_INDICADOR_CFOP, TRIBUT_ICMS.DESCRICAO, TRIBUT_ICMS2.DESCRICAO, TRIBUT_ORIGEM.DESCRICAO, TRIBUT_ORIGEM2.DESCRICAO, CLASSIF_FISCAL.DESC_CLASSIFICACAO, B.DESC_CLASSIFICACAO, PRODUTOS.CONTA_CONTABIL,MATERIAIS.CONTA_CONTABIL,  CTB_CONTA_PLANO.DESC_CONTA , CTB_CONTA_PLANO2.DESC_CONTA, PRODUTOS_INDICADOR_CFOP.INDICADOR_CFOP, FILIAIS.INDICA_CFOP_SOMENTE_REVENDA, MATERIAIS_INDICADOR_CFOP.INDICADOR_CFOP',N'@P1 varchar(9),@P2 varchar(6)','DR VAREJO','375928'
